<app-page-layout
  [title]="'pages.licenseManagement.title' | translate"
  [description]="'pages.licenseManagement.description' | translate"
  icon="ðŸ”‘"
  [actions]="pageActions()">
  
  <!-- License Status Card -->
  <app-glass-card customClass="p-6">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-4">
        <div class="p-3 rounded-full bg-blue-100 dark:bg-blue-900">
          <span class="text-3xl">{{ licenseService.getStatusIcon(getLicense()().status) }}</span>
        </div>
        <div>
          <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100">
            {{ getLicense()().type.toUpperCase() }} {{ 'pages.licenseManagement.license' | translate }}
          </h2>
          <p class="text-gray-600 dark:text-gray-400">
            {{ 'pages.licenseManagement.status' | translate }}: <span [class]="licenseService.getStatusTextClass(getLicense()().status)" class="font-semibold">
              {{ getLicense()().status.toUpperCase() }}
            </span>
          </p>
        </div>
      </div>
      <div class="text-right">
        <p class="text-sm text-gray-600 dark:text-gray-400">{{ 'pages.licenseManagement.expires' | translate }}</p>
        <p [class]="licenseService.getExpiryClass()" class="text-lg font-semibold">
          {{ formatDate(getLicense()().expiryDate) }}
        </p>
      </div>
    </div>
  </app-glass-card>

  <!-- License Details -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- License Information -->
    <app-glass-card customClass="p-6">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">{{ 'pages.licenseManagement.licenseInformation' | translate }}</h3>
      <div class="space-y-3">
        <div class="flex justify-between">
          <span class="text-gray-600 dark:text-gray-400">{{ 'pages.licenseManagement.licenseKey' | translate }}:</span>
          <span class="font-mono text-sm text-gray-900 dark:text-gray-100">{{ getLicense()().id.substring(0, 20) }}...</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600 dark:text-gray-400">{{ 'pages.licenseManagement.type' | translate }}:</span>
          <span class="font-semibold text-gray-900 dark:text-gray-100">{{ getLicense()().type }}</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600 dark:text-gray-400">{{ 'pages.licenseManagement.issued' | translate }}:</span>
          <span class="text-gray-900 dark:text-gray-100">{{ formatDate(getLicense()().issuedDate) }}</span>
        </div>
      </div>
    </app-glass-card>

    <!-- Usage Statistics -->
    <app-glass-card customClass="p-6">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">{{ 'pages.licenseManagement.usageStatistics' | translate }}</h3>
      <div class="space-y-3">
        <div>
          <div class="flex justify-between mb-1">
            <span class="text-sm text-gray-600 dark:text-gray-400">{{ 'pages.licenseManagement.users' | translate }}</span>
            <span class="text-sm font-semibold text-gray-900 dark:text-gray-100">
              {{ getUsage()().activeUsers }} / {{ getLicense()().maxUsers }}
            </span>
          </div>
          <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
            <div class="bg-blue-600 h-2 rounded-full" [style.width.%]="getUsagePercentage('users')"></div>
          </div>
        </div>
        <div>
          <div class="flex justify-between mb-1">
            <span class="text-sm text-gray-600 dark:text-gray-400">{{ 'pages.licenseManagement.companies' | translate }}</span>
            <span class="text-sm font-semibold text-gray-900 dark:text-gray-100">
              {{ getUsage()().activeCompanies }} / {{ getLicense()().maxCompanies }}
            </span>
          </div>
          <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
            <div class="bg-green-600 h-2 rounded-full" [style.width.%]="getUsagePercentage('companies')"></div>
          </div>
        </div>
      </div>
    </app-glass-card>
  </div>

  <!-- Activation Modal -->
  <app-modal
    [isOpen]="showActivationModal()"
    title="Activate License"
    (closed)="closeActivationModal()"
  >
    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
          License Key <span class="text-red-500">*</span>
        </label>
        <input
          [(ngModel)]="activationForm.licenseKey"
          type="text"
          class="glass-input w-full"
          placeholder="Enter license key"
        />
      </div>
      <div>
        <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
          Company Name <span class="text-red-500">*</span>
        </label>
        <input
          [(ngModel)]="activationForm.companyName"
          type="text"
          class="glass-input w-full"
          placeholder="Enter company name"
        />
      </div>
    </div>
    <div slot="footer">
      <app-glass-button variant="secondary" (clicked)="closeActivationModal()">
        {{ 'common.cancel' | translate }}
      </app-glass-button>
      <app-glass-button variant="primary" (clicked)="activateLicense()">
        {{ 'Activate' | translate }}
      </app-glass-button>
    </div>
  </app-modal>
</app-page-layout>
