<app-page-layout
  [title]="'pages.departments.title' | translate"
  [subtitle]="'pages.departments.description' | translate"
  [actions]="pageActions()">
  
  <!-- Filter Section -->
  <app-filter-section
    [fields]="filterFields"
    [loading]="loading()"
    (search)="onSearch($event)"
    (filterChange)="onFilterChange($event)">
  </app-filter-section>

  <!-- Error Message -->
  @if (errorMessage()) {
    <div class="error-message">
      {{ errorMessage() }}
    </div>
  }

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-state">
      <p>{{ 'common.loading' | translate }}</p>
    </div>
  }

  <!-- Data Table -->
  @if (!loading() && departments().length > 0) {
    <app-data-table
      [data]="departments()"
      [columns]="columns"
      [actions]="actions"
      [pagination]="{
        currentPage: currentPage(),
        pageSize: pageSize(),
        total: totalRecords(),
        totalPages: totalPages()
      }"
      (pageChange)="onPageChange($event)"
      (pageSizeChange)="onPageSizeChange($event)">
    </app-data-table>
  }

  <!-- Empty State -->
  @if (!loading() && departments().length === 0) {
    <app-empty-state
      [title]="'pages.departments.noDepartmentsFound' | translate"
      [message]="'pages.departments.description' | translate"
      [actions]="emptyStateActions()">
    </app-empty-state>
  }

  <!-- Add/Edit Modal -->
  <app-modal
    [isOpen]="showModal()"
    [title]="editingDepartment() ? ('pages.departments.editDepartment' | translate) : ('pages.departments.addDepartment' | translate)"
    [loading]="saving()"
    (closed)="closeModal()">
    <app-modal-form
      [fields]="formFields()"
      [loading]="saving()"
      (submitted)="onFormSubmitted($event)"
      (cancelled)="closeModal()">
    </app-modal-form>
  </app-modal>

  <!-- Delete Confirmation Modal -->
  <app-modal
    [isOpen]="showDeleteModal()"
    [title]="'pages.departments.deleteDepartment' | translate"
    [loading]="deleting()"
    (closed)="cancelDelete()">
    <div class="delete-confirmation">
      <p>Are you sure you want to delete <strong>{{ deletingDepartment()?.thName || deletingDepartment()?.engName }}</strong>?</p>
      <p class="warning">This action cannot be undone.</p>
      <div class="modal-actions">
        <app-glass-button
          variant="danger"
          [loading]="deleting()"
          (clicked)="deleteDepartment()">
          Delete
        </app-glass-button>
        <app-glass-button
          variant="secondary"
          [disabled]="deleting()"
          (clicked)="cancelDelete()">
          Cancel
        </app-glass-button>
      </div>
    </div>
  </app-modal>
</app-page-layout>
