<div class="event-checkin-history-container">
  <app-page-layout
    [title]="'Event Check-in History'"
    [description]="eventName()"
    [actions]="pageActions()"
  >
    <!-- Filters -->
    <div class="filters-section mb-6">
      <app-filter-section
        [fields]="filterFields()"
        (filterChange)="onFilterChange($event)"
      ></app-filter-section>
    </div>

    <!-- Loading State -->
    @if (loading()) {
      <div class="flex justify-center items-center py-12">
        <div class="text-center">
          <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"></div>
          <p class="text-gray-600 dark:text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>
      </div>
    }

    <!-- Error Message -->
    @if (errorMessage()) {
      <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6">
        <p class="text-red-800 dark:text-red-400">{{ errorMessage() }}</p>
      </div>
    }

    <!-- Empty State -->
    @if (!loading() && checkInRecords().length === 0) {
      <div class="text-center py-12">
        <div class="text-6xl mb-4">üìã</div>
        <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">
          ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Check-in History
        </h3>
        <p class="text-gray-600 dark:text-gray-400">
          ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Check-in
        </p>
      </div>
    }

    <!-- Timeline View -->
    @if (!loading() && checkInRecords().length > 0) {
      <div class="checkin-history-content">
        <!-- Summary Stats -->
        <div class="stats-grid mb-6">
          <div class="stat-card">
            <div class="stat-label">Total Check-ins</div>
            <div class="stat-value">{{ totalRecords() }}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Today</div>
            <div class="stat-value">
              {{ getTodayCheckIns() }}
            </div>
          </div>
        </div>

        <!-- Timeline by Date -->
        <div class="timeline-container">
          @for (dateKey of getDateKeys(); track dateKey) {
            <div class="timeline-date-group mb-8">
              <!-- Date Header -->
              <div class="date-header">
                <h3 class="date-title">{{ dateKey }}</h3>
                <span class="date-count">{{ groupedRecords()[dateKey].length }} check-ins</span>
              </div>

              <!-- Timeline Items -->
              <div class="timeline-items">
                @for (record of groupedRecords()[dateKey]; track record.attendeeId) {
                  <div class="timeline-item">
                    <!-- Timeline Line -->
                    <div class="timeline-line"></div>
                    
                    <!-- Timeline Dot -->
                    <div class="timeline-dot">
                      <div class="dot-inner"></div>
                    </div>

                    <!-- Timeline Content -->
                    <div class="timeline-content">
                      <div class="content-header">
                        <div class="user-info">
                          <div class="user-name">
                            {{ record.firstName || record.memberFirstName || 'N/A' }}
                            {{ record.lastName || record.memberLastName || '' }}
                          </div>
                          <div class="user-email">{{ record.email || record.memberEmail || 'N/A' }}</div>
                        </div>
                        <div class="checkin-time">
                          <div class="time-icon">üïê</div>
                          <div class="time-text">{{ formatTime(record.checkInTime) }}</div>
                        </div>
                      </div>
                      <div class="content-footer">
                        <span class="status-badge checked-in">CHECKED IN</span>
                        <span class="full-time">{{ formatDateTime(record.checkInTime) }}</span>
                      </div>
                    </div>
                  </div>
                }
              </div>
            </div>
          }
        </div>

        <!-- Pagination -->
        @if (totalPages() > 1) {
          <div class="pagination-container mt-8">
            <div class="pagination-info">
              ‡πÅ‡∏™‡∏î‡∏á {{ (currentPage() - 1) * pageSize() + 1 }} - 
              {{ Math.min(currentPage() * pageSize(), totalRecords()) }} 
              ‡∏à‡∏≤‡∏Å {{ totalRecords() }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            </div>
            <div class="pagination-controls">
              <app-glass-button
                [variant]="'secondary'"
                [disabled]="currentPage() === 1"
                (click)="onPageChange(currentPage() - 1)"
              >
                ‚Üê Previous
              </app-glass-button>
              <span class="page-info">
                ‡∏´‡∏ô‡πâ‡∏≤ {{ currentPage() }} / {{ totalPages() }}
              </span>
              <app-glass-button
                [variant]="'secondary'"
                [disabled]="currentPage() === totalPages()"
                (click)="onPageChange(currentPage() + 1)"
              >
                Next ‚Üí
              </app-glass-button>
            </div>
          </div>
        }
      </div>
    }
  </app-page-layout>
</div>

