<div class="payroll-reports-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Payroll Reports</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-tab-group [(selectedIndex)]="activeTab">
        <mat-tab label="Summary Report">
          <div class="tab-content">
            <div class="report-filters">
              <mat-form-field appearance="outline">
                <mat-label>Start Month</mat-label>
                <mat-select [(ngModel)]="summaryParams.startMonth">
                  <mat-option *ngFor="let month of getMonthOptions()" [value]="month">
                    {{ getMonthName(month) }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Start Year</mat-label>
                <mat-select [(ngModel)]="summaryParams.startYear">
                  <mat-option *ngFor="let year of getYearOptions()" [value]="year">
                    {{ year }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>End Month</mat-label>
                <mat-select [(ngModel)]="summaryParams.endMonth">
                  <mat-option *ngFor="let month of getMonthOptions()" [value]="month">
                    {{ getMonthName(month) }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>End Year</mat-label>
                <mat-select [(ngModel)]="summaryParams.endYear">
                  <mat-option *ngFor="let year of getYearOptions()" [value]="year">
                    {{ year }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <button mat-raised-button color="primary" (click)="loadSummaryReport()" [disabled]="loading">
                <mat-icon>search</mat-icon>
                Generate Report
              </button>

              <button mat-button (click)="exportSummaryReport()" [disabled]="!summaryData || loading">
                <mat-icon>download</mat-icon>
                Export
              </button>
            </div>

            <div *ngIf="loading; else summaryContent" class="loading-container">
              <mat-spinner></mat-spinner>
            </div>

            <ng-template #summaryContent>
              <div class="summary-report" *ngIf="summaryData; else noSummaryData">
                <div class="summary-cards">
                  <div class="summary-card">
                    <mat-icon>people</mat-icon>
                    <div class="card-content">
                      <span class="card-label">Total Employees</span>
                      <span class="card-value">{{ summaryData.totalEmployees }}</span>
                    </div>
                  </div>

                  <div class="summary-card">
                    <mat-icon>attach_money</mat-icon>
                    <div class="card-content">
                      <span class="card-label">Total Gross Salary</span>
                      <span class="card-value">{{ summaryData.totalGrossSalary | number:'1.2-2' }} ฿</span>
                    </div>
                  </div>

                  <div class="summary-card">
                    <mat-icon>remove_circle</mat-icon>
                    <div class="card-content">
                      <span class="card-label">Total Deductions</span>
                      <span class="card-value">{{ summaryData.totalDeductions | number:'1.2-2' }} ฿</span>
                    </div>
                  </div>

                  <div class="summary-card">
                    <mat-icon>receipt</mat-icon>
                    <div class="card-content">
                      <span class="card-label">Total Tax</span>
                      <span class="card-value">{{ summaryData.totalTax | number:'1.2-2' }} ฿</span>
                    </div>
                  </div>

                  <div class="summary-card highlight">
                    <mat-icon>account_balance_wallet</mat-icon>
                    <div class="card-content">
                      <span class="card-label">Total Net Salary</span>
                      <span class="card-value">{{ summaryData.totalNetSalary | number:'1.2-2' }} ฿</span>
                    </div>
                  </div>
                </div>
              </div>

              <ng-template #noSummaryData>
                <div class="no-data">
                  <mat-icon>assessment</mat-icon>
                  <p>No summary data. Please generate a report.</p>
                </div>
              </ng-template>
            </ng-template>
          </div>
        </mat-tab>

        <mat-tab label="Detailed Report">
          <div class="tab-content">
            <div class="report-filters">
              <mat-form-field appearance="outline">
                <mat-label>Start Month</mat-label>
                <mat-select [(ngModel)]="detailedReportParams.startMonth">
                  <mat-option *ngFor="let month of getMonthOptions()" [value]="month">
                    {{ getMonthName(month) }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Start Year</mat-label>
                <mat-select [(ngModel)]="detailedReportParams.startYear">
                  <mat-option *ngFor="let year of getYearOptions()" [value]="year">
                    {{ year }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>End Month</mat-label>
                <mat-select [(ngModel)]="detailedReportParams.endMonth">
                  <mat-option *ngFor="let month of getMonthOptions()" [value]="month">
                    {{ getMonthName(month) }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>End Year</mat-label>
                <mat-select [(ngModel)]="detailedReportParams.endYear">
                  <mat-option *ngFor="let year of getYearOptions()" [value]="year">
                    {{ year }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Department</mat-label>
                <input matInput [(ngModel)]="detailedReportParams.department" placeholder="Optional">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Employee ID</mat-label>
                <input matInput [(ngModel)]="detailedReportParams.employeeId" placeholder="Optional">
              </mat-form-field>

              <button mat-raised-button color="primary" (click)="loadDetailedReport()" [disabled]="loading">
                <mat-icon>search</mat-icon>
                Generate Report
              </button>

              <button mat-button (click)="exportDetailedReport()" [disabled]="detailedReportData.length === 0 || loading">
                <mat-icon>download</mat-icon>
                Export
              </button>
            </div>

            <div *ngIf="loading; else detailedContent" class="loading-container">
              <mat-spinner></mat-spinner>
            </div>

            <ng-template #detailedContent>
              <div class="detailed-report" *ngIf="detailedReportData.length > 0; else noDetailedData">
                <app-data-table
                  [columns]="detailedReportColumns"
                  [data]="detailedReportData"
                  [pageSize]="20">
                </app-data-table>
              </div>

              <ng-template #noDetailedData>
                <div class="no-data">
                  <mat-icon>description</mat-icon>
                  <p>No detailed report data. Please generate a report.</p>
                </div>
              </ng-template>
            </ng-template>
          </div>
        </mat-tab>
      </mat-tab-group>
    </mat-card-content>
  </mat-card>
</div>

