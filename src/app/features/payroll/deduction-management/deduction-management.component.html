<div class="deduction-management-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Deduction Management</mat-card-title>
      <div class="header-controls">
        <mat-form-field appearance="outline">
          <mat-label>Year</mat-label>
          <mat-select [value]="selectedYear" (selectionChange)="onYearChange($event.value)">
            <mat-option *ngFor="let year of getYearOptions()" [value]="year">
              {{ year }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </mat-card-header>
    <mat-card-content>
      <mat-tab-group [(selectedIndex)]="activeTab">
        <mat-tab label="All Deductions">
          <div class="tab-content">
            <div class="deduction-summary" *ngIf="deductions.length > 0">
              <div class="summary-card">
                <h3>Total Deductions ({{ selectedYear }})</h3>
                <div class="summary-amount">
                  <span class="amount-value">{{ getTotalDeductions() | number:'1.2-2' }} ฿</span>
                </div>
                <div class="summary-detail">
                  <span>Active: {{ getActiveDeductions().length }} items</span>
                </div>
              </div>
            </div>

            <div *ngIf="loading; else deductionsContent" class="loading-container">
              <mat-spinner></mat-spinner>
            </div>

            <ng-template #deductionsContent>
              <div class="deductions-list" *ngIf="deductions.length > 0; else noDeductions">
                <app-data-table
                  [columns]="deductionColumns"
                  [data]="deductions"
                  [pageSize]="15">
                </app-data-table>
              </div>

              <ng-template #noDeductions>
                <div class="no-data">
                  <mat-icon>account_balance_wallet</mat-icon>
                  <p>No deductions found for {{ selectedYear }}</p>
                </div>
              </ng-template>
            </ng-template>
          </div>
        </mat-tab>

        <mat-tab label="Active Deductions">
          <div class="tab-content">
            <div *ngIf="loading; else activeDeductionsContent" class="loading-container">
              <mat-spinner></mat-spinner>
            </div>

            <ng-template #activeDeductionsContent>
              <div class="deductions-list" *ngIf="getActiveDeductions().length > 0; else noActiveDeductions">
                <div class="deduction-item" *ngFor="let deduction of getActiveDeductions()">
                  <div class="deduction-header">
                    <div class="deduction-info">
                      <mat-icon>account_balance_wallet</mat-icon>
                      <div>
                        <h4>{{ deduction.description }}</h4>
                        <span class="deduction-type">{{ deduction.deductionType }}</span>
                      </div>
                    </div>
                    <div class="deduction-amount">
                      <span class="amount">{{ deduction.amount | number:'1.2-2' }} ฿</span>
                      <span class="frequency">{{ getFrequencyLabel(deduction.frequency) }}</span>
                    </div>
                  </div>
                  <div class="deduction-details">
                    <div class="detail-item">
                      <span class="label">Start Date:</span>
                      <span>{{ deduction.startDate | dateFormat:'short' }}</span>
                    </div>
                    <div class="detail-item" *ngIf="deduction.endDate">
                      <span class="label">End Date:</span>
                      <span>{{ deduction.endDate | dateFormat:'short' }}</span>
                    </div>
                    <div class="detail-item" *ngIf="!deduction.endDate">
                      <span class="label">Status:</span>
                      <mat-chip [color]="getStatusColor(deduction.status)">
                        {{ deduction.status }}
                      </mat-chip>
                    </div>
                  </div>
                </div>
              </div>

              <ng-template #noActiveDeductions>
                <div class="no-data">
                  <mat-icon>check_circle</mat-icon>
                  <p>No active deductions for {{ selectedYear }}</p>
                </div>
              </ng-template>
            </ng-template>
          </div>
        </mat-tab>
      </mat-tab-group>
    </mat-card-content>
  </mat-card>
</div>

