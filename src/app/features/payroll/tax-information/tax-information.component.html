<div class="tax-information-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Tax Information</mat-card-title>
      <div class="header-controls">
        <mat-form-field appearance="outline">
          <mat-label>Tax Year</mat-label>
          <mat-select [value]="selectedYear" (selectionChange)="onYearChange($event.value)">
            <mat-option *ngFor="let year of getYearOptions()" [value]="year">
              {{ year }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </mat-card-header>
    <mat-card-content>
      <mat-tab-group [(selectedIndex)]="activeTab">
        <mat-tab label="Current Year Tax">
          <div class="tab-content">
            <div *ngIf="loading; else taxInfoContent" class="loading-container">
              <mat-spinner></mat-spinner>
            </div>

            <ng-template #taxInfoContent>
              <div class="tax-info" *ngIf="taxInfo; else noTaxInfo">
                <div class="tax-summary">
                  <div class="summary-item">
                    <span class="label">Tax ID Number:</span>
                    <span class="value">{{ taxInfo.taxIdNumber || 'N/A' }}</span>
                  </div>
                  <div class="summary-item">
                    <span class="label">Tax Status:</span>
                    <span class="value">{{ taxInfo.taxStatus || 'N/A' }}</span>
                  </div>
                  <div class="summary-item highlight">
                    <span class="label">Total Income:</span>
                    <span class="value">{{ taxInfo.totalIncome | number:'1.2-2' }} ฿</span>
                  </div>
                  <div class="summary-item">
                    <span class="label">Total Deductions:</span>
                    <span class="value">{{ taxInfo.totalDeductions | number:'1.2-2' }} ฿</span>
                  </div>
                  <div class="summary-item highlight">
                    <span class="label">Taxable Income:</span>
                    <span class="value">{{ taxInfo.taxableIncome | number:'1.2-2' }} ฿</span>
                  </div>
                  <div class="summary-item">
                    <span class="label">Tax Paid:</span>
                    <span class="value">{{ taxInfo.taxPaid | number:'1.2-2' }} ฿</span>
                  </div>
                  <div class="summary-item" *ngIf="taxInfo.withholdingTax">
                    <span class="label">Withholding Tax:</span>
                    <span class="value">{{ taxInfo.withholdingTax | number:'1.2-2' }} ฿</span>
                  </div>
                  <div class="summary-item" *ngIf="taxInfo.taxRefund">
                    <span class="label">Tax Refund:</span>
                    <span class="value refund">{{ taxInfo.taxRefund | number:'1.2-2' }} ฿</span>
                  </div>
                </div>

                <div class="tax-documents">
                  <h3>Tax Documents</h3>
                  <div class="documents-list">
                    <div class="document-item" *ngFor="let docType of documentTypes">
                      <div class="document-info">
                        <mat-icon>description</mat-icon>
                        <span>{{ getDocumentTypeLabel(docType.value) }}</span>
                      </div>
                      <button mat-raised-button color="primary" (click)="downloadTaxDocument(docType.value)">
                        <mat-icon>download</mat-icon>
                        Download
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <ng-template #noTaxInfo>
                <div class="no-data">
                  <mat-icon>receipt_long</mat-icon>
                  <p>No tax information available for {{ selectedYear }}</p>
                </div>
              </ng-template>
            </ng-template>
          </div>
        </mat-tab>

        <mat-tab label="Tax History">
          <div class="tab-content">
            <div *ngIf="loading; else taxHistoryContent" class="loading-container">
              <mat-spinner></mat-spinner>
            </div>

            <ng-template #taxHistoryContent>
              <div class="tax-history" *ngIf="taxHistory.length > 0; else noHistory">
                <app-data-table
                  [columns]="taxHistoryColumns"
                  [data]="taxHistory"
                  [pageSize]="10">
                </app-data-table>
              </div>

              <ng-template #noHistory>
                <div class="no-data">
                  <mat-icon>history</mat-icon>
                  <p>No tax history available</p>
                </div>
              </ng-template>
            </ng-template>
          </div>
        </mat-tab>
      </mat-tab-group>
    </mat-card-content>
  </mat-card>
</div>

