<section class="login-container">
  <!-- Language and Theme Toggle Controls -->
  <div class="login-controls">
    <div class="login-controls-group">
      <!-- Language Switcher -->
      <div class="relative" appClickOutside (appClickOutside)="closeLanguageMenu()">
        <app-glass-button
          type="button"
          variant="secondary"
          size="sm"
          (clicked)="toggleLanguageMenu()"
          [ariaLabel]="'layout.header.changeLanguage' | translate"
          [title]="'layout.header.changeLanguage' | translate"
          [attr.aria-expanded]="showLanguageMenu"
          [attr.aria-controls]="'language-menu'"
          customClass="control-button language-button">
          <img [src]="currentLanguage.flagPath" [alt]="currentLanguage.name" class="control-icon w-5 h-5 rounded-sm object-cover" />
        </app-glass-button>

        <!-- Language Dropdown -->
        <app-glass-card
          *ngIf="showLanguageMenu"
          variant="strong"
          padding="p-0"
          customClass="language-dropdown absolute right-0 top-full mt-2 w-48
                       rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 theme-myhr:border-primary/30
                       z-50 overflow-hidden
                       backdrop-blur-xl
                       animate-scale-in
                       [animation-duration:200ms]
                       origin-top-right">
          <div id="language-menu" role="menu" [attr.aria-label]="'layout.header.languageMenuAriaLabel' | translate" class="py-1">
            <button
              *ngFor="let lang of availableLanguages; let i = index"
              type="button"
              role="menuitem"
              (click)="changeLanguage(lang.code)"
              [class.active]="currentLang === lang.code"
              [attr.aria-label]="('layout.header.changeLanguageTo' | translate) + ' ' + lang.name"
              [attr.aria-current]="currentLang === lang.code ? 'true' : 'false'"
              [style.--animation-delay]="(i * 50) + 'ms'"
              class="language-item w-full px-4 py-2.5 text-left flex items-center gap-3
                     hover:bg-gray-50 dark:hover:bg-gray-700 theme-myhr:hover:bg-white/20
                     hover:translate-x-1 hover:scale-[1.02]
                     active:scale-[0.98]
                     transition-all duration-200 ease-out
                     animate-fade-in">
              <img [src]="lang.flagPath" [alt]="lang.name" class="w-5 h-5 rounded-sm object-cover" />
              <span class="flex-1 thai-text text-sm font-medium text-gray-700 dark:text-gray-300 theme-myhr:text-white/90">{{ lang.name }}</span>
              <app-icon *ngIf="currentLang === lang.code" name="check" size="sm" color="text-primary theme-myhr:text-primary"></app-icon>
            </button>
          </div>
        </app-glass-card>
      </div>

      <!-- Theme Toggle -->
      <app-theme-toggle></app-theme-toggle>
    </div>
  </div>

  <div class="login-layout">
    <!-- Left Section - Promotional (40%) -->
    <div class="login-left-section">
      <!-- Animated Background Vectors -->
      <div class="login-vector-bg">
        <svg class="vector-shape vector-1" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
          <path d="M50,50 Q100,0 150,50 T250,50" stroke="rgba(255,255,255,0.1)" stroke-width="2" fill="none"/>
          <circle cx="100" cy="100" r="30" fill="rgba(255,255,255,0.05)"/>
          <path d="M30,170 Q100,120 170,170" stroke="rgba(255,255,255,0.08)" stroke-width="2" fill="none"/>
        </svg>
        <svg class="vector-shape vector-2" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
          <polygon points="100,20 180,80 140,180 60,180 20,80" fill="rgba(255,255,255,0.03)"/>
          <circle cx="100" cy="100" r="40" fill="rgba(255,255,255,0.04)"/>
        </svg>
        <svg class="vector-shape vector-3" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
          <path d="M20,100 Q50,50 100,50 T180,100" stroke="rgba(255,255,255,0.06)" stroke-width="2" fill="none"/>
          <circle cx="50" cy="150" r="25" fill="rgba(255,255,255,0.04)"/>
          <circle cx="150" cy="50" r="20" fill="rgba(255,255,255,0.05)"/>
        </svg>
      </div>

      <!-- Floating Particles -->
      <div class="particles">
        <div class="particle particle-1"></div>
        <div class="particle particle-2"></div>
        <div class="particle particle-3"></div>
        <div class="particle particle-4"></div>
        <div class="particle particle-5"></div>
      </div>

      <div class="login-left-content">
        <div class="login-left-pattern"></div>
        <div class="login-left-logo animated-logo">
          <img src="assets/images/logo/logo-myhr-light.png" alt="myHR Logo" class="login-left-logo-img" />
        </div>
        <div class="login-left-text animated-text">
          <h1 class="login-left-title">{{ 'features.auth.forgotPassword.title' | translate }}</h1>
          <p class="login-left-subtitle">{{ 'features.auth.forgotPassword.subtitle' | translate }}</p>
        </div>
      </div>
    </div>

    <!-- Right Section - Forgot Password Form (60%) -->
    <div class="login-right-section">
      <div class="login-right-content">
        <!-- Logo Section -->
        <div class="login-logo-section animated-logo-right">
          <div class="login-logo">
            <img
              src="assets/images/logo/logo-myhr-dark.png"
              alt="myHR Logo"
              class="login-logo-img"
              [attr.aria-label]="'myHR Logo'" />
          </div>
        </div>

        <!-- Forgot Password Title -->
        <div class="login-title-section animated-title">
          <h2 class="login-title thai-text">{{ 'features.auth.forgotPassword.recoverTitle' | translate }}</h2>
          <p class="login-subtitle thai-text">{{ 'features.auth.forgotPassword.recoverSubtitle' | translate }}</p>
        </div>

        <!-- Forgot Password Form -->
        <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()" class="login-form" [attr.aria-label]="'features.auth.forgotPassword.formAriaLabel' | translate">
          <!-- Database Selection Field -->
          <div class="form-field" *ngIf="dbList.length > 0">
            <app-glass-select
              [label]="'features.auth.forgotPassword.selectDatabase' | translate"
              [placeholder]="'features.auth.forgotPassword.selectDatabase' | translate"
              [options]="dbSelectOptions"
              [(ngModel)]="dbSelected"
              [ngModelOptions]="{standalone: true}"
              (ngModelChange)="onDbChangeSelect($event)"
              [ariaLabel]="'features.auth.forgotPassword.selectDatabase' | translate">
            </app-glass-select>
          </div>

          <!-- Username Field -->
          <div class="form-field">
            <app-glass-input
              [label]="'features.auth.forgotPassword.username' | translate"
              [placeholder]="'features.auth.forgotPassword.username' | translate"
              type="text"
              formControlName="username"
              [required]="true"
              [useFormValidationMessages]="true"
              [ariaLabel]="'features.auth.forgotPassword.username' | translate">
              <app-form-validation-messages [control]="forgotPasswordForm.get('username')"></app-form-validation-messages>
            </app-glass-input>
          </div>

          <!-- Email Field -->
          <div class="form-field">
            <app-glass-input
              [label]="'features.auth.forgotPassword.email' | translate"
              [placeholder]="'features.auth.forgotPassword.email' | translate"
              type="email"
              formControlName="email"
              [required]="true"
              [useFormValidationMessages]="true"
              [ariaLabel]="'features.auth.forgotPassword.email' | translate">
              <app-form-validation-messages [control]="forgotPasswordForm.get('email')"></app-form-validation-messages>
            </app-glass-input>
          </div>

          <!-- Success Message -->
          <app-alert
            *ngIf="successMessage"
            variant="success"
            [dismissible]="false"
            [title]="'features.auth.forgotPassword.success' | translate"
            [message]="successMessage">
          </app-alert>

          <!-- Error Message -->
          <app-alert
            *ngIf="errorMessage"
            variant="error"
            [dismissible]="false"
            [title]="'features.auth.forgotPassword.error.title' | translate"
            [message]="formatErrorMessage(errorMessage)">
          </app-alert>

          <!-- Submit Button -->
          <div class="form-submit">
            <app-glass-button
              type="submit"
              variant="primary"
              size="lg"
              [loading]="loading"
              [disabled]="loading || !username || !email"
              [fullWidth]="true"
              [ariaLabel]="'features.auth.forgotPassword.sendPassword' | translate">
              {{ loading ? ('features.auth.forgotPassword.sending' | translate) : ('features.auth.forgotPassword.sendPassword' | translate) }}
            </app-glass-button>
          </div>

          <!-- Back to Login -->
          <div class="form-footer">
            <app-glass-button
              type="button"
              variant="secondary"
              size="md"
              (clicked)="onBackToLogin()"
              [ariaLabel]="'features.auth.forgotPassword.backToLogin' | translate">
              <app-icon name="arrow_back" size="sm"></app-icon>
              <span>{{ 'features.auth.forgotPassword.backToLogin' | translate }}</span>
            </app-glass-button>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>

