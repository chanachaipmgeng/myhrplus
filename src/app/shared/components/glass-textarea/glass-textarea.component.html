<div [class]="containerClass">
  <label *ngIf="label" [for]="textareaId" class="block text-sm font-medium text-gray-700 dark:text-gray-200 theme-gemini:text-white/90 mb-2">
    {{ label }}
    <span *ngIf="required" class="text-red-500 dark:text-red-400 theme-gemini:text-red-400 ml-1" aria-label="จำเป็น">*</span>
  </label>
  <div class="relative">
    <textarea
      [id]="textareaId"
      [rows]="rows"
      [placeholder]="placeholder"
      [disabled]="disabled"
      [readonly]="readonly"
      [value]="value"
      [attr.maxlength]="maxLength || null"
      [attr.aria-label]="ariaLabel || label"
      [attr.aria-describedby]="describedByIds || null"
      [attr.aria-invalid]="hasError || isOverLimit"
      [attr.aria-required]="required"
      [attr.aria-disabled]="disabled"
      (input)="onInput($event)"
      (blur)="onBlur()"
      (focus)="onFocus()"
      class="glass rounded-md px-4 py-3 md:py-2.5 text-base md:text-sm text-gray-900 dark:text-gray-100 theme-gemini:text-white placeholder:text-gray-400 dark:placeholder:text-gray-500 theme-gemini:placeholder:text-white/60 shadow-sm transition-all duration-300 focus:glass-strong focus:shadow-md focus:scale-[1.01] hover:shadow-md hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed dark:glass-dark dark:focus:glass-dark-strong theme-gemini:glass-gemini theme-gemini:focus:glass-gemini-strong w-full resize-none"
      [ngClass]="{
        'border-red-500 dark:border-red-400 theme-gemini:border-red-400': hasError || isOverLimit,
        'border-green-500 dark:border-green-400 theme-gemini:border-green-400': isValid && showSuccess && !hasError,
        'animate-shake': hasError || isOverLimit,
        'ring-2 ring-red-500/20 dark:ring-red-400/20 theme-gemini:ring-red-400/20': hasError || isOverLimit,
        'ring-2 ring-green-500/20 dark:ring-green-400/20 theme-gemini:ring-green-400/20': isValid && showSuccess && !hasError,
        'min-h-auto': autoResize
      }">
    </textarea>

    <!-- Success Icon -->
    <div *ngIf="isValid && showSuccess && !hasError && value"
         class="absolute right-3 top-3 pointer-events-none">
      <app-icon name="check_circle"
                size="sm"
                color="text-green-500 dark:text-green-400 theme-gemini:text-green-400"
                class="animate-pulse-success">
      </app-icon>
    </div>

    <!-- Error Icon -->
    <div *ngIf="(hasError || isOverLimit) && errorMessage"
         class="absolute right-3 top-3 pointer-events-none">
      <app-icon name="error"
                size="sm"
                color="text-red-500 dark:text-red-400 theme-gemini:text-red-400">
      </app-icon>
    </div>
  </div>

  <!-- Character Counter -->
  <div *ngIf="showCounter && maxLength"
       [id]="textareaId + '-counter'"
       class="flex justify-between items-center mt-1 text-xs"
       [ngClass]="{
         'text-gray-500 dark:text-gray-400 theme-gemini:text-white/60': !isOverLimit,
         'text-red-500 dark:text-red-400 theme-gemini:text-red-400': isOverLimit
       }">
    <span></span>
    <span>
      {{ characterCount }} / {{ maxLength }}
    </span>
  </div>

  <!-- Error Message -->
  <div *ngIf="(hasError || isOverLimit) && errorMessage"
       [id]="errorMessageId"
       role="alert"
       class="flex items-center gap-1.5 text-red-500 dark:text-red-400 theme-gemini:text-red-400 text-sm mt-1 animate-fade-in"
       aria-live="polite">
    <app-icon name="error" size="xs" color="text-red-500 dark:text-red-400 theme-gemini:text-red-400"></app-icon>
    <span class="thai-text">{{ errorMessage }}</span>
  </div>

  <!-- Success Message -->
  <div *ngIf="isValid && showSuccess && successMessage && !hasError"
       [id]="successMessageId"
       role="status"
       class="flex items-center gap-1.5 text-green-500 dark:text-green-400 theme-gemini:text-green-400 text-sm mt-1 animate-fade-in"
       aria-live="polite">
    <app-icon name="check_circle" size="xs" color="text-green-500 dark:text-green-400 theme-gemini:text-green-400"></app-icon>
    <span class="thai-text">{{ successMessage }}</span>
  </div>

  <!-- Hint Message -->
  <div *ngIf="hint && !hasError && !isValid && !isOverLimit"
       [id]="hintId"
       class="text-gray-500 dark:text-gray-400 theme-gemini:text-white/60 text-sm mt-1">
    {{ hint }}
  </div>
</div>

