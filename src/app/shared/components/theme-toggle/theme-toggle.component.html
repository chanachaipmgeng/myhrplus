<div class="flex items-center gap-2 theme-toggle-container">
  <!-- Theme Mode Toggle -->
  <div class="relative">
    <button
      #modeButton
      (click)="toggleModeMenu()"
      [attr.aria-label]="'เปลี่ยนธีม'"
      [attr.aria-expanded]="showModeMenu"
      [attr.aria-haspopup]="true"
      role="button"
      tabindex="0"
      class="p-2 text-slate-700 dark:text-slate-200 hover:bg-white/30 dark:hover:bg-slate-700/30 rounded-lg transition-all duration-200">
      <app-icon [name]="currentModeIcon" size="md" color="text-slate-700 dark:text-slate-200" [ariaLabel]="'ธีมปัจจุบัน: ' + currentMode"></app-icon>
    </button>
    <div 
      *ngIf="showModeMenu"
      role="menu"
      [attr.aria-label]="'เมนูเลือกธีม'"
      class="absolute right-0 mt-2 w-48 bg-white/90 dark:bg-slate-900/90 backdrop-blur-lg rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50">
      <button
        role="menuitemradio"
        [attr.aria-checked]="currentMode === 'light'"
        (click)="setMode('light')"
        [class.active]="currentMode === 'light'"
        class="w-full px-4 py-2 text-left text-slate-700 dark:text-slate-200 hover:bg-white/40 dark:hover:bg-slate-700/40 flex items-center gap-2 thai-text">
        <app-icon name="light_mode" size="sm" color="text-slate-600 dark:text-slate-400" aria-hidden="true"></app-icon>
        <span>โหมดสว่าง</span>
      </button>
      <button
        role="menuitemradio"
        [attr.aria-checked]="currentMode === 'dark'"
        (click)="setMode('dark')"
        [class.active]="currentMode === 'dark'"
        class="w-full px-4 py-2 text-left text-slate-700 dark:text-slate-200 hover:bg-white/40 dark:hover:bg-slate-700/40 flex items-center gap-2 thai-text">
        <app-icon name="dark_mode" size="sm" color="text-slate-600 dark:text-slate-400" aria-hidden="true"></app-icon>
        <span>โหมดมืด</span>
      </button>
      <button
        role="menuitemradio"
        [attr.aria-checked]="currentMode === 'auto'"
        (click)="setMode('auto')"
        [class.active]="currentMode === 'auto'"
        class="w-full px-4 py-2 text-left text-slate-700 dark:text-slate-200 hover:bg-white/40 dark:hover:bg-slate-700/40 flex items-center gap-2 thai-text">
        <app-icon name="brightness_auto" size="sm" color="text-slate-600 dark:text-slate-400" aria-hidden="true"></app-icon>
        <span>อัตโนมัติ</span>
      </button>
    </div>
  </div>

  <!-- Theme Color Picker -->
  <div class="relative">
    <button
      #colorButton
      (click)="toggleColorMenu()"
      [attr.aria-label]="'เปลี่ยนสีธีม'"
      [attr.aria-expanded]="showColorMenu"
      [attr.aria-haspopup]="true"
      role="button"
      tabindex="0"
      class="p-2 text-slate-700 dark:text-slate-200 hover:bg-white/30 dark:hover:bg-slate-700/30 rounded-lg transition-all duration-200">
      <app-icon name="palette" size="md" color="text-slate-700 dark:text-slate-200" [ariaLabel]="'สีธีมปัจจุบัน: ' + currentColor"></app-icon>
    </button>
    <div 
      *ngIf="showColorMenu"
      role="menu"
      [attr.aria-label]="'เมนูเลือกสีธีม'"
      class="absolute right-0 mt-2 w-64 bg-white/90 dark:bg-slate-900/90 backdrop-blur-lg rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-3 z-50">
      <div class="grid grid-cols-4 gap-2" role="group">
        <button
          *ngFor="let color of themeColors"
          role="menuitemradio"
          [attr.aria-checked]="currentColor === color.value"
          (click)="setColor(color.value)"
          [class.active]="currentColor === color.value"
          class="w-10 h-10 rounded-lg border-2 transition-all duration-200 hover:scale-110 hover:shadow-lg"
          [style.background]="color.gradient"
          [class.border-indigo-500]="currentColor === color.value"
          [class.border-slate-300]="currentColor !== color.value"
          [class.dark:border-slate-600]="currentColor !== color.value"
          [attr.aria-label]="color.name">
        </button>
      </div>
    </div>
  </div>
</div>


