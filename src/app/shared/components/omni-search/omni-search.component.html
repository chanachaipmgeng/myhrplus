<!-- Omni-Search Modal -->
<div
  *ngIf="isOpen"
  class="omni-search-overlay fixed inset-0 z-[200] flex items-start justify-center pt-20 px-4 bg-black/50 backdrop-blur-sm"
  (click)="close()">
  <div
    class="omni-search-modal w-full max-w-2xl"
    (click)="$event.stopPropagation()">
    <app-glass-card class="p-0">
      <!-- Search Input -->
      <div class="p-4 border-b border-black/10 dark:border-white/10">
        <div class="relative">
          <input
            #searchInput
            [formControl]="searchControl"
            type="text"
            placeholder="ค้นหาเมนู... (Ctrl+K)"
            class="w-full px-4 py-3 pl-12 pr-4 text-lg
                   bg-transparent border border-black/10 dark:border-white/10 rounded-lg
                   text-gray-900 dark:text-gray-100
                   focus:outline-none focus:ring-2 focus:ring-primary/20
                   placeholder:text-gray-500 dark:placeholder:text-gray-400">
          <app-icon
            name="search"
            size="md"
            color="text-gray-500 dark:text-gray-400"
            class="absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none">
          </app-icon>
          <button
            *ngIf="searchControl.value"
            type="button"
            (click)="searchControl.setValue('')"
            class="absolute right-4 top-1/2 -translate-y-1/2 w-6 h-6 flex items-center justify-center
                   rounded-md hover:bg-black/5 dark:hover:bg-white/10
                   text-gray-500 dark:text-gray-400"
            aria-label="Clear search">
            <app-icon name="close" size="sm"></app-icon>
          </button>
        </div>
      </div>

      <!-- Search Results -->
      <div
        #resultsContainer
        class="max-h-96 overflow-y-auto">
        <div *ngIf="searchResults.length === 0 && searchControl.value" class="p-8 text-center">
          <app-icon
            name="search_off"
            size="xl"
            color="text-gray-400 dark:text-gray-600"
            class="mb-2 opacity-50">
          </app-icon>
          <p class="text-sm text-gray-500 dark:text-gray-400">ไม่พบผลลัพธ์</p>
        </div>

        <div *ngIf="searchResults.length > 0" class="py-2">
          <div
            *ngFor="let result of searchResults; let i = index"
            (click)="selectResult(result)"
            (mouseenter)="selectedIndex = i"
            [class.selected]="selectedIndex === i"
            [ngClass]="{
              'bg-primary/10': selectedIndex === i,
              'dark:bg-primary/20': selectedIndex === i,
              'border-l-primary': selectedIndex === i,
              'dark:border-l-primary': selectedIndex === i
            }"
            class="search-result-item px-4 py-3 cursor-pointer transition-colors
                   hover:bg-black/5 dark:hover:bg-white/10
                   border-l-[3px] border-transparent
                   hover:border-primary">
            <div class="flex items-center gap-3">
              <app-icon
                [name]="result.icon"
                size="md"
                color="text-gray-600 dark:text-gray-400">
              </app-icon>
              <div class="flex-1 min-w-0">
                <div class="font-medium text-gray-900 dark:text-gray-100 text-sm">
                  {{ result.name }}
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1 truncate">
                  {{ result.breadcrumb }}
                </div>
              </div>
              <div class="text-xs px-2 py-1 rounded
                          bg-gray-100 dark:bg-gray-800
                          text-gray-600 dark:text-gray-400">
                {{ result.level === 1 ? 'Module' : result.level === 2 ? 'Page' : result.level === 3 ? 'Tab' : 'Sub' }}
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="!searchControl.value" class="p-8 text-center">
          <app-icon
            name="search"
            size="xl"
            color="text-gray-400 dark:text-gray-600"
            class="mb-2 opacity-50">
          </app-icon>
          <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">ค้นหาเมนู</p>
          <p class="text-xs text-gray-400 dark:text-gray-500">กด Ctrl+K หรือ Cmd+K เพื่อเปิด</p>
        </div>
      </div>
    </app-glass-card>
  </div>
</div>

