<header class="glass-nav backdrop-blur-xl border-b border-white/20 dark:border-gray-700/20 theme-gemini:border-primary/30 shadow-2xl transition-all duration-500 ease-in-out sticky top-0 left-0 right-0 z-50 gemini-header px-3 sm:px-4 md:px-6
            animate-fade-in
            hover:shadow-3xl">
  <div class="flex items-center justify-between py-3 md:py-4">
    <div class="flex items-center gap-2 md:gap-4 flex-1 min-w-0">
      <!-- Menu Toggle Button -->
      <app-glass-button
        type="button"
        variant="secondary"
        size="sm"
        [ariaLabel]="'layout.header.menuAriaLabel' | translate"
        [title]="'layout.header.menu' | translate"
        customClass="w-11 h-11 min-w-[44px] min-h-[44px] p-0 rounded-lg
                     hover:scale-110 active:scale-95
                     hover:shadow-lg hover:-translate-y-0.5
                     group relative overflow-hidden"
        (clicked)="toggleSidenav.emit()">
        <app-icon name="menu" size="md" color="text-gray-700 dark:text-gray-300 theme-gemini:text-white/90
                   group-hover:scale-110 transition-transform duration-300"></app-icon>
      </app-glass-button>

      <!-- Logo Section -->
      <div class="flex items-center gap-2 md:gap-3 flex-shrink-0 min-w-0">
        <a routerLink="/home"
           [attr.aria-label]="'layout.header.goToHome' | translate"
           class="inline-flex items-center justify-center w-11 h-11 min-w-[44px] min-h-[44px] md:w-10 md:h-10 rounded-lg
                    bg-white/10 dark:bg-gray-900/20 theme-gemini:bg-gray-900/30
                    backdrop-blur-sm
                    border border-white/20 dark:border-gray-700/20 theme-gemini:border-primary/30
                    shadow-lg flex-shrink-0 relative overflow-hidden
                    hover:scale-110 hover:shadow-xl
                    transition-all duration-300 ease-out
                    group cursor-pointer
                    animate-gemini-pulse">
          <!-- Shimmer Effect -->
          <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent
                      -translate-x-full group-hover:translate-x-full
                      transition-transform duration-1000 ease-in-out"></div>
          <img [src]="getLogoPath()"
               [alt]="'layout.header.appLogo' | translate"
               class="w-8 h-8 md:w-9 md:h-9 object-contain relative z-10
                      group-hover:scale-110 transition-transform duration-300" />
        </a>
        <div class="flex flex-col min-w-0 hidden sm:block">
          <span class="app-title thai-text font-semibold text-gray-800 dark:text-gray-100 theme-gemini:bg-gradient-to-r theme-gemini:from-primary theme-gemini:via-primary theme-gemini:to-primary theme-gemini:bg-clip-text theme-gemini:text-transparent text-sm md:text-lg leading-tight truncate">
            {{ 'layout.header.appTitle' | translate }}
          </span>
          <span class="app-title-en font-medium text-gray-600 dark:text-gray-400 theme-gemini:text-white/80 text-xs hidden md:block">
            {{ 'layout.header.appTitleEn' | translate }}
          </span>
        </div>
      </div>
    </div>

    <!-- Omni-Search (Center) -->
    <div class="flex-1 flex justify-center px-4 hidden md:flex">
      <button
        type="button"
        (click)="openOmniSearch()"
        [attr.aria-label]="'layout.header.searchMenuAriaLabel' | translate"
        class="omni-search-trigger w-full max-w-md px-4 py-2 rounded-lg
               bg-white/50 dark:bg-gray-800/50 theme-gemini:bg-gray-800/30
               border border-gray-200 dark:border-gray-700 theme-gemini:border-primary/30
               text-left flex items-center gap-3
               hover:bg-white/70 dark:hover:bg-gray-800/70 theme-gemini:hover:bg-gray-800/50
               hover:scale-[1.02] hover:shadow-lg hover:-translate-y-0.5
               active:scale-[0.98]
               transition-all duration-300 ease-out
               focus:outline-none focus:ring-2 focus:ring-blue-500/20
               group relative overflow-hidden">
        <!-- Hover Glow Effect -->
        <div class="absolute inset-0 bg-gradient-to-r from-primary/0 via-primary/5 to-primary/0
                    opacity-0 group-hover:opacity-100
                    transition-opacity duration-300"></div>
        <app-icon name="search" size="sm" color="text-gray-500 dark:text-gray-400 theme-gemini:text-white/70
                   group-hover:scale-110 group-hover:text-primary dark:group-hover:text-primary
                   transition-all duration-300 relative z-10"></app-icon>
        <span class="flex-1 text-sm text-gray-500 dark:text-gray-400 theme-gemini:text-white/70 relative z-10
                     group-hover:text-gray-700 dark:group-hover:text-gray-300
                     transition-colors duration-300">
          {{ 'layout.header.searchMenuPlaceholder' | translate }}
        </span>
        <kbd class="hidden lg:inline-flex items-center gap-1 px-2 py-1 text-xs font-semibold
                    bg-gray-100 dark:bg-gray-700 theme-gemini:bg-gray-700/50
                    text-gray-600 dark:text-gray-300 theme-gemini:text-white/70
                    border border-gray-300 dark:border-gray-600 theme-gemini:border-primary/30 rounded">
          <span>Ctrl</span>
          <span>K</span>
        </kbd>
      </button>
    </div>

    <div class="flex items-center gap-2 md:gap-3 flex-shrink-0">
      <!-- Omni-Search Button (Mobile) -->
      <app-glass-button
        type="button"
        variant="secondary"
        size="sm"
        [ariaLabel]="'layout.header.searchMenuAriaLabel' | translate"
        [title]="'layout.header.searchMenuTitle' | translate"
        customClass="md:hidden w-11 h-11 min-w-[44px] min-h-[44px] p-0 rounded-lg
                     hover:scale-110 active:scale-95
                     hover:shadow-lg hover:-translate-y-0.5
                     group relative overflow-hidden"
        (clicked)="openOmniSearch()">
        <app-icon name="search" size="md" color="text-gray-700 dark:text-gray-300 theme-gemini:text-white/90
                   group-hover:scale-110 group-hover:text-primary dark:group-hover:text-primary
                   transition-all duration-300 relative z-10"></app-icon>
      </app-glass-button>

      <!-- Language Switcher -->
      <div class="relative" appClickOutside (appClickOutside)="closeLanguageMenu()">
        <app-glass-button
          type="button"
          variant="secondary"
          size="sm"
          [ariaLabel]="'layout.header.changeLanguage' | translate"
          [title]="'layout.header.changeLanguage' | translate"
          [attr.aria-expanded]="showLanguageMenu"
          [attr.aria-controls]="'language-menu'"
          customClass="w-11 h-11 min-w-[44px] min-h-[44px] md:w-10 md:h-10 p-0 rounded-lg
                       hover:scale-110 active:scale-95
                       hover:shadow-lg hover:-translate-y-0.5
                       group overflow-hidden"
          (clicked)="toggleLanguageMenu()">
          <app-icon name="language" size="md" color="text-gray-700 dark:text-gray-300 theme-gemini:text-white/90
                     group-hover:scale-110 group-hover:rotate-12
                     transition-all duration-300 relative z-10"></app-icon>
        </app-glass-button>

        <!-- Language Dropdown -->
        <app-glass-card
          *ngIf="showLanguageMenu"
          variant="strong"
          padding="p-0"
          customClass="language-dropdown absolute right-0 top-full mt-2 w-48
                       rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 theme-gemini:border-primary/30
                       z-50 overflow-hidden
                       backdrop-blur-xl
                       animate-scale-in
                       [animation-duration:200ms]
                       origin-top-right">
          <div id="language-menu" role="menu" [attr.aria-label]="'layout.header.languageMenuAriaLabel' | translate" class="py-1">
            <button
              *ngFor="let lang of languages; let i = index"
              type="button"
              role="menuitem"
              (click)="changeLanguage(lang.value)"
              [class.active]="currentLanguage === lang.value"
              [attr.aria-label]="('layout.header.changeLanguageTo' | translate) + ' ' + lang.label"
              [attr.aria-current]="currentLanguage === lang.value ? 'true' : 'false'"
              [style.--animation-delay]="(i * 50) + 'ms'"
              class="language-item w-full px-4 py-2.5 text-left flex items-center gap-3
                     hover:bg-gray-50 dark:hover:bg-gray-700 theme-gemini:hover:bg-white/20
                     hover:translate-x-1 hover:scale-[1.02]
                     active:scale-[0.98]
                     transition-all duration-200 ease-out
                     animate-fade-in">
              <img [src]="lang.flagPath" [alt]="lang.label" class="w-5 h-5 rounded-sm object-cover" />
              <span class="flex-1 thai-text text-sm font-medium text-gray-700 dark:text-gray-300 theme-gemini:text-white/90">{{ lang.label }}</span>
              <app-icon *ngIf="currentLanguage === lang.value" name="check" size="sm" color="text-primary theme-gemini:text-primary"></app-icon>
            </button>
          </div>
        </app-glass-card>
      </div>

      <!-- Theme Toggle -->
      <app-theme-toggle></app-theme-toggle>

      <!-- Notifications -->
      <div class="relative" appClickOutside (appClickOutside)="closeNotificationMenu()">
        <app-glass-button
          type="button"
          variant="secondary"
          size="sm"
          [ariaLabel]="('layout.header.notifications' | translate) + (unreadCount > 0 ? ' (' + unreadCount + ' ' + ('layout.header.newItems' | translate) + ')' : '')"
          [title]="'layout.header.notifications' | translate"
          [attr.aria-expanded]="showNotificationMenu"
          [attr.aria-controls]="'notification-menu'"
          customClass="w-11 h-11 min-w-[44px] min-h-[44px] md:w-10 md:h-10 p-0 rounded-lg relative
                       hover:scale-110 active:scale-95
                       hover:shadow-lg hover:-translate-y-0.5
                       group overflow-hidden"
          (clicked)="toggleNotificationMenu()">
          <app-icon name="notifications" size="md" color="text-gray-700 dark:text-gray-300 theme-gemini:text-white/90
                     group-hover:scale-110 group-hover:animate-bounce
                     transition-all duration-300 relative z-10"></app-icon>
          <span *ngIf="unreadCount > 0"
                [attr.aria-label]="unreadCount + ' ' + ('layout.header.newItems' | translate)"
                class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 dark:bg-red-400 rounded-full
                       flex items-center justify-center text-white text-xs font-bold shadow-lg
                       animate-pulse z-20
                       group-hover:scale-125 group-hover:shadow-xl
                       transition-all duration-300">
            {{ unreadCount > 9 ? '9+' : unreadCount }}
          </span>
        </app-glass-button>

        <!-- Notification Dropdown -->
        <app-glass-card
          *ngIf="showNotificationMenu"
          variant="strong"
          padding="p-0"
          customClass="notification-dropdown absolute right-0 top-full mt-2 w-80 md:w-96
                       rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 theme-gemini:border-primary/30
                       z-50 max-h-96 overflow-hidden flex flex-col
                       backdrop-blur-xl
                       animate-scale-in
                       [animation-duration:200ms]
                       origin-top-right">
          <div id="notification-menu" role="menu" [attr.aria-label]="'layout.header.notificationMenuAriaLabel' | translate" class="flex flex-col">
          <!-- Header -->
          <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700 theme-gemini:border-primary/30 flex items-center justify-between bg-gray-50 dark:bg-gray-900 theme-gemini:bg-gray-900/70">
            <h3 class="font-semibold text-gray-800 dark:text-gray-200 theme-gemini:text-white/90 thai-text">{{ 'layout.header.notifications' | translate }}</h3>
            <button
              *ngIf="unreadCount > 0"
              type="button"
              role="menuitem"
              (click)="markAllAsRead()"
              [attr.aria-label]="'layout.header.markAllAsRead' | translate"
              class="text-xs text-primary dark:text-primary hover:text-primary/80 dark:hover:text-primary/80 transition-colors">
              {{ 'layout.header.markAllAsRead' | translate }}
            </button>
          </div>

          <!-- Notifications List -->
          <div class="overflow-y-auto flex-1">
            <div *ngIf="notifications.length === 0"
                 class="p-8 text-center">
              <app-icon name="notifications_none" size="xl" color="text-gray-400 dark:text-gray-600 theme-gemini:text-white/60" class="mb-2 block mx-auto"></app-icon>
              <p class="text-gray-500 dark:text-gray-400 theme-gemini:text-white/70 thai-text text-sm">{{ 'layout.header.noNotifications' | translate }}</p>
            </div>

            <div *ngFor="let notification of notifications; let i = index"
                 role="menuitem"
                 tabindex="0"
                 (click)="handleNotificationClick(notification)"
                 (keydown.enter)="handleNotificationClick(notification)"
                 (keydown.space)="handleNotificationClick(notification); $event.preventDefault()"
                 [class.unread]="!notification.read"
                 [attr.aria-label]="notification.title + (notification.read ? '' : ' (' + ('layout.header.unread' | translate) + ')')"
                 [style.--animation-delay]="(i * 30) + 'ms'"
                 class="notification-item px-4 py-3 border-b border-gray-100 dark:border-gray-700 theme-gemini:border-primary/20
                        cursor-pointer
                        transition-all duration-200 ease-out
                        hover:bg-gray-50 dark:hover:bg-gray-700/50 theme-gemini:hover:bg-white/10
                        hover:translate-x-1 hover:scale-[1.01]
                        active:scale-[0.99]
                        animate-fade-in">
              <div class="flex items-start gap-3">
                <div class="flex-shrink-0 mt-1">
                  <app-icon
                    [name]="getNotificationIconName(notification.type)"
                    size="md"
                    [color]="getNotificationIconColor(notification.type)"
                    class="notification-icon">
                  </app-icon>
                </div>
                <div class="flex-1 min-w-0">
                  <div class="flex items-start justify-between gap-2 mb-1">
                    <h4 class="font-semibold text-sm text-gray-800 dark:text-gray-200 theme-gemini:text-white/90 thai-text truncate">
                      {{ notification.title }}
                    </h4>
                    <span *ngIf="!notification.read"
                          class="flex-shrink-0 w-2 h-2 bg-primary theme-gemini:bg-primary rounded-full mt-1"></span>
                  </div>
                  <p class="text-xs text-gray-600 dark:text-gray-400 theme-gemini:text-white/80 thai-text line-clamp-2 mb-1">
                    {{ notification.message }}
                  </p>
                  <span class="text-xs text-gray-400 dark:text-gray-500 theme-gemini:text-white/60">
                    {{ getTimeAgo(notification.timestamp) }}
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- Footer -->
          <div *ngIf="notifications.length > 0"
               class="px-4 py-2 border-t border-gray-200 dark:border-gray-700 theme-gemini:border-primary/30 bg-gray-50 dark:bg-gray-900 theme-gemini:bg-gray-900/70 text-center">
            <button
              type="button"
              role="menuitem"
              [attr.aria-label]="'layout.header.viewAll' | translate"
              class="text-xs text-primary dark:text-primary hover:text-primary/80 dark:hover:text-primary/80 transition-colors">
              {{ 'layout.header.viewAll' | translate }}
            </button>
          </div>
          </div>
        </app-glass-card>
      </div>

      <!-- User Menu -->
      <div class="relative" appClickOutside (appClickOutside)="closeUserMenu()" *ngIf="currentUser">
        <button
          type="button"
          (click)="toggleUserMenu()"
          [attr.aria-label]="'layout.header.userMenu' | translate"
          [attr.aria-expanded]="showUserMenu"
          [attr.aria-controls]="'user-menu'"
          class="user-menu-trigger flex items-center gap-2 md:gap-3 px-2 md:px-3 py-2 rounded-lg
                 bg-white/10 dark:bg-gray-800/20 theme-gemini:bg-gray-800/30
                 border border-white/20 dark:border-gray-700/20 theme-gemini:border-primary/30
                 hover:bg-white/20 dark:hover:bg-gray-800/30 theme-gemini:hover:bg-gray-800/50
                 hover:scale-[1.02] hover:shadow-lg
                 active:scale-[0.98]
                 transition-all duration-300 ease-out
                 group relative overflow-hidden
                 backdrop-blur-sm">
          <!-- Avatar -->
          <div class="flex-shrink-0 group-hover:scale-110 group-hover:ring-2 group-hover:ring-primary/50
                      transition-all duration-300 ease-out">
            <app-avatar
              [src]="getAvatarUrl() || ''"
              [name]="getUserDisplayName()"
              size="sm"
              [status]="'online'">
            </app-avatar>
          </div>

          <!-- User Info (Hidden on mobile, shown on md+) -->
          <div class="flex flex-col items-start min-w-0 hidden md:block">
            <span class="text-sm font-semibold thai-text text-gray-800 dark:text-gray-100 theme-gemini:text-white/90 truncate max-w-[120px]">
              {{ getUserDisplayName() }}
            </span>
            <span class="text-xs text-gray-600 dark:text-gray-400 theme-gemini:text-white/70 truncate max-w-[120px]" *ngIf="getUserRole()">
              {{ getUserRole() }}
            </span>
          </div>

          <!-- Dropdown Icon -->
          <div class="flex-shrink-0 transition-transform duration-300 ease-out
                       group-hover:scale-110"
               [class.rotate-180]="showUserMenu">
            <app-icon name="expand_more" size="sm" color="text-gray-600 dark:text-gray-400 theme-gemini:text-white/70
                       group-hover:text-primary dark:group-hover:text-primary
                       transition-colors duration-300"></app-icon>
          </div>
        </button>

        <!-- User Menu Dropdown -->
        <app-glass-card
          *ngIf="showUserMenu"
          variant="strong"
          padding="p-0"
          customClass="user-dropdown absolute right-0 top-full mt-2 w-64 md:w-72
                       rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 theme-gemini:border-primary/30
                       z-50 overflow-hidden
                       backdrop-blur-xl
                       animate-scale-in
                       [animation-duration:200ms]
                       origin-top-right">
          <div id="user-menu" role="menu" [attr.aria-label]="'layout.header.userMenu' | translate">
            <!-- User Header Section -->
            <div class="px-4 py-4 border-b border-gray-200 dark:border-gray-700 theme-gemini:border-primary/30
                        bg-gradient-to-br from-gray-50/50 to-white/50 dark:from-gray-900/50 dark:to-gray-800/50
                        theme-gemini:from-gray-900/70 theme-gemini:to-gray-800/70">
              <div class="flex items-center gap-3">
                <div class="flex-shrink-0">
                  <app-avatar
                    [src]="getAvatarUrl() || ''"
                    [name]="getUserDisplayName()"
                    size="md"
                    [status]="'online'">
                  </app-avatar>
                </div>
                <div class="flex-1 min-w-0">
                  <div class="text-sm font-semibold thai-text text-gray-800 dark:text-gray-100 theme-gemini:text-white/90 truncate">
                    {{ getUserDisplayName() }}
                  </div>
                  <div class="text-xs text-gray-600 dark:text-gray-400 theme-gemini:text-white/70 truncate" *ngIf="getUserRole()">
                    {{ getUserRole() }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Menu Items -->
            <div class="py-1">
              <button
                type="button"
                role="menuitem"
                (click)="onProfile()"
                [attr.aria-label]="'layout.header.openProfile' | translate"
                class="user-menu-item w-full px-4 py-2.5 text-left flex items-center gap-3
                       hover:bg-gray-50 dark:hover:bg-gray-700 theme-gemini:hover:bg-white/20
                       hover:translate-x-1 hover:scale-[1.02]
                       active:scale-[0.98]
                       transition-all duration-200 ease-out
                       animate-fade-in
                       [animation-delay:50ms]">
                <app-icon name="person" size="sm" color="text-gray-600 dark:text-gray-400 theme-gemini:text-white/70
                           group-hover:text-primary dark:group-hover:text-primary
                           transition-colors duration-200"></app-icon>
                <span class="thai-text text-sm font-medium text-gray-700 dark:text-gray-300 theme-gemini:text-white/90">{{ 'layout.header.profile' | translate }}</span>
              </button>
              <button
                type="button"
                role="menuitem"
                (click)="onPreferences()"
                [attr.aria-label]="'layout.header.openSettings' | translate"
                class="user-menu-item w-full px-4 py-2.5 text-left flex items-center gap-3
                       hover:bg-gray-50 dark:hover:bg-gray-700 theme-gemini:hover:bg-white/20
                       hover:translate-x-1 hover:scale-[1.02]
                       active:scale-[0.98]
                       transition-all duration-200 ease-out
                       animate-fade-in
                       [animation-delay:100ms]">
                <app-icon name="settings" size="sm" color="text-gray-600 dark:text-gray-400 theme-gemini:text-white/70
                           group-hover:text-primary dark:group-hover:text-primary
                           transition-colors duration-200"></app-icon>
                <span class="thai-text text-sm font-medium text-gray-700 dark:text-gray-300 theme-gemini:text-white/90">{{ 'layout.header.settings' | translate }}</span>
              </button>
              <div class="border-t border-gray-200 dark:border-gray-700 theme-gemini:border-primary/30 my-1"></div>
              <button
                type="button"
                role="menuitem"
                (click)="onLogout()"
                [attr.aria-label]="'layout.header.logout' | translate"
                class="user-menu-item w-full px-4 py-2.5 text-left flex items-center gap-3
                       hover:bg-red-50 dark:hover:bg-red-900/20 theme-gemini:hover:bg-red-900/30
                       hover:translate-x-1 hover:scale-[1.02]
                       active:scale-[0.98]
                       transition-all duration-200 ease-out
                       text-red-600 dark:text-red-400
                       animate-fade-in
                       [animation-delay:150ms]">
                <app-icon name="logout" size="sm" color="text-red-600 dark:text-red-400
                           group-hover:scale-110 transition-transform duration-200"></app-icon>
                <span class="thai-text text-sm font-medium">{{ 'layout.header.logout' | translate }}</span>
              </button>
            </div>
          </div>
        </app-glass-card>
      </div>
    </div>
  </div>

  <!-- Omni-Search Component -->
  <app-omni-search #omniSearch (resultSelected)="onOmniSearchResult($event)"></app-omni-search>
</header>

