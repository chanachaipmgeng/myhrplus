<ng-container *ngIf="{
  isHandset: isHandset$ | async,
  sidebarOpen: sidebarOpen$ | async,
  hiddenHeader: hiddenHeader$ | async
} as layout">
  <div
    class="w-full overflow-x-hidden relative min-h-screen transition-all duration-300 layout-background"
    appSwipe
    (swipeRight)="onSwipeRight()"
    (swipeLeft)="onSwipeLeft()"
  >
    <!-- Syncfusion Sidebar -->
    <ejs-sidebar
      #sidebar
      [width]="sidebarWidth"
      [isOpen]="layout.sidebarOpen"
      [type]="sidebarType"
      [position]="'Left'"
      [closeOnDocumentClick]="layout.isHandset"
      (close)="onSidebarClose()"
      class="modern-sidebar"
    >
      <app-sidebar></app-sidebar>
    </ejs-sidebar>

    <!-- Main Content -->
    <div
      #mainWrapper
      class="main-wrapper flex-1 min-h-screen flex flex-col transition-all duration-300"
      [class.main-wrapper-sidebar-open]="layout.sidebarOpen && !layout.isHandset"
      [class.main-wrapper-sidebar-closed]="!layout.sidebarOpen && !layout.isHandset"
      [class.main-wrapper-mobile]="layout.isHandset"
    >
      <!-- Header - Hidden when hiddenHeader === 'hidden' (for ESS mode) -->
      <app-header
        *ngIf="layout.hiddenHeader !== 'hidden'"
        (toggleSidenav)="toggleSidebar()"
      ></app-header>



      <div
        class="relative flex-1 min-h-0 p-4 md:p-6 lg:p-8 animate-fade-in [animation-delay:100ms] content-area content-area-with-header"
        [style.padding-bottom]="layout.hiddenHeader !== 'hidden' ? 'var(--header-height-md)' : '0'"
      >
      <!-- Breadcrumb - Standard Location -->
      <!-- Use autoGenerate to update breadcrumb when URL changes directly -->
      <!-- Fallback to sidebar breadcrumbs if available, otherwise use auto-generated from route -->
      <div class="breadcrumb-wrapper -mx-4 md:-mx-6 lg:-mx-8 px-4 md:px-6 lg:px-8 mb-4 md:mb-6
                  animate-fade-in [animation-delay:100ms]"
           *ngIf="layout.hiddenHeader !== 'hidden'">
        <app-breadcrumbs
          [items]="breadcrumbs"
          [separator]="'/'"
          [showHome]="false"
          [autoGenerate]="false">
        </app-breadcrumbs>
      </div>
        <div class="animate-slide-up [animation-delay:200ms]">
          <router-outlet></router-outlet>
        </div>
      </div>
      <app-footer></app-footer>
    </div>
  </div>
</ng-container>
