<ng-container *ngIf="{
  isHandset: isHandset$ | async,
  sidebarOpen: sidebarOpen$ | async
} as layout">
  <div
    class="w-full overflow-x-hidden relative min-h-screen transition-all duration-300 layout-background"
    appSwipe
    (swipeRight)="onSwipeRight()"
    (swipeLeft)="onSwipeLeft()">
    <!-- Syncfusion Sidebar -->
    <ejs-sidebar
      #sidebar
      [width]="sidebarWidth"
      [isOpen]="layout.sidebarOpen"
      [type]="sidebarType"
      [position]="'Left'"
      [closeOnDocumentClick]="layout.isHandset"
      (close)="onSidebarClose()"
      class="modern-sidebar">
      <app-sidebar></app-sidebar>
    </ejs-sidebar>

    <!-- Main Content -->
    <div
      class="main-wrapper flex-1 min-h-screen flex flex-col transition-all duration-300 relative"
      [class.main-wrapper-sidebar-open]="layout.sidebarOpen && !layout.isHandset"
      [class.main-wrapper-sidebar-closed]="!layout.sidebarOpen && !layout.isHandset"
      [class.main-wrapper-mobile]="layout.isHandset">
      <!-- Header (Sticky - ติดบนหน้าจอตลอด) -->
      <div class="sticky-header-wrapper">
        <app-header
          (toggleSidenav)="toggleSidebar()"
        ></app-header>
      </div>

      <!-- Scrollable Content Area -->
      <div class="main-content-wrapper flex-1 flex flex-col min-h-0 overflow-y-auto">
        <!-- Content Container -->
        <div class="content-container flex-1 relative">
          <!-- Breadcrumb Section -->
          <div class="breadcrumb-section px-4 md:px-6 lg:px-8 pt-4 md:pt-6 pb-2 md:pb-4 fade-in"
               [style.animation-delay.ms]="100">
            <app-breadcrumbs
              [items]="breadcrumbs"
              [separator]="'/'"
              [showHome]="false"
              [autoGenerate]="false">
            </app-breadcrumbs>
          </div>

          <!-- Route Content -->
          <div class="route-content-wrapper p-4 md:p-6 lg:p-8">
            <div class="route-container relative">
              <div [@routeFade]="prepareRoute(outlet)">
                <router-outlet #outlet="outlet"></router-outlet>
              </div>
            </div>
          </div>
        </div>

        <!-- Footer (Sticky at bottom) -->
        <div class="sticky-footer-wrapper mt-auto">
          <app-footer></app-footer>
        </div>
      </div>
    </div>
  </div>
</ng-container>
